{"version":3,"file":"leadcalc-impact.min.js","sources":["../../packages/loader-impact/src/index.ts"],"sourcesContent":["type Options = {\n  apiBase: string;\n  configVersion?: string;\n  theme?: 'light'|'dark';\n  referralCookie?: string;\n  iframeBase?: string;\n};\n\ndeclare global {\n  interface Window {\n    OFACalculator: {\n      init: (elOrId: HTMLElement|string, opts: Options) => void;\n    };\n  }\n}\n\n(function () {\n  const DEFAULTS: Partial<Options> = {\n    iframeBase: (typeof window !== 'undefined' ? window.location.origin : '') + '',\n    theme: 'light',\n    configVersion: '1.0.0',\n    referralCookie: 'referral'\n  };\n  function getEl(elOrId: HTMLElement|string): HTMLElement {\n    if (typeof elOrId === 'string') {\n      const el = document.getElementById(elOrId);\n      if (!el) throw new Error(`OFACalculator: container #${elOrId} not found`);\n      return el;\n    }\n    return elOrId;\n  }\n  function readCookie(name: string): string | null {\n    const m = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([$()*+./?[\\\\\\\\]^{|}])/g, '\\\\$1') + '=([^;]*)'));\n    return m ? decodeURIComponent(m[1]) : null;\n  }\n  function init(elOrId: HTMLElement|string, options: Options) {\n    const opts = { ...DEFAULTS, ...options };\n    const container = getEl(elOrId);\n    \n    // Prevent duplicate initialization\n    if (container.querySelector('iframe')) {\n      console.warn('OFACalculator: container already initialized, skipping');\n      return;\n    }\n    \n    const wrapper = document.createElement('div');\n    wrapper.style.position = 'relative';\n    wrapper.style.width = '100%';\n    const iframe = document.createElement('iframe');\n    iframe.title = 'OFA Calculator Widget';\n    iframe.allow = 'clipboard-write';\n    iframe.loading = 'lazy';\n    iframe.style.width = '1px';\n    iframe.style.minWidth = '100%';\n    iframe.style.border = '0';\n    iframe.style.display = 'block';\n    const src = new URL(`${opts.iframeBase!.replace(/\\/$/,'')}/embed/impact`);\n    src.searchParams.set('v', String(opts.configVersion));\n    src.searchParams.set('theme', String(opts.theme));\n    iframe.src = src.toString();\n    wrapper.appendChild(iframe);\n    container.appendChild(wrapper);\n    const referral = readCookie(opts.referralCookie!);\n    function onMessage(ev: MessageEvent) {\n      const allowed = new URL(opts.iframeBase!).origin;\n      if (ev.origin !== allowed) return;\n      if ((ev.data && ev.data.type) === 'OFA_CALCULATOR_READY') {\n        iframe.contentWindow?.postMessage({\n          type: 'OFA_CALCULATOR_BOOT',\n          payload: {\n            apiBase: opts.apiBase,\n            configVersion: String(opts.configVersion),\n            theme: opts.theme,\n            referralToken: referral ?? null\n          }\n        }, allowed);\n      }\n      if ((ev.data && ev.data.type) === 'OFA_CALCULATOR_RESIZE') {\n        const h = Number(ev.data.height || 0);\n        if (h > 0) iframe.style.height = `${h}px`;\n      }\n    }\n    window.addEventListener('message', onMessage);\n  }\n  window.OFACalculator = { init };\n})();\n\n// Make this file a module so global augmentation works\nexport {};\n"],"names":["DEFAULTS","iframeBase","window","location","origin","theme","configVersion","referralCookie","OFACalculator","init","elOrId","options","opts","container","el","document","getElementById","Error","getEl","querySelector","console","warn","wrapper","createElement","style","position","width","iframe","title","allow","loading","minWidth","border","display","src","URL","replace","searchParams","set","String","toString","appendChild","referral","name","m","cookie","match","RegExp","decodeURIComponent","readCookie","addEventListener","ev","allowed","data","type","contentWindow","postMessage","payload","apiBase","referralToken","h","Number","height"],"mappings":"2FAgBA,WACE,MAAMA,EAA6B,CACjCC,YAA+B,oBAAXC,OAAyBA,OAAOC,SAASC,OAAS,IAAM,GAC5EC,MAAO,QACPC,cAAe,QACfC,eAAgB,YA+DlBL,OAAOM,cAAgB,CAAEC,KAjDzB,SAAcC,EAA4BC,GACxC,MAAMC,EAAO,IAAKZ,KAAaW,GACzBE,EAdR,SAAeH,GACb,GAAsB,iBAAXA,EAAqB,CAC9B,MAAMI,EAAKC,SAASC,eAAeN,GACnC,IAAKI,EAAI,MAAM,IAAIG,MAAM,6BAA6BP,eACtD,OAAOI,CACT,CACA,OAAOJ,CACT,CAOoBQ,CAAMR,GAGxB,GAAIG,EAAUM,cAAc,UAE1B,YADAC,QAAQC,KAAK,0DAIf,MAAMC,EAAUP,SAASQ,cAAc,OACvCD,EAAQE,MAAMC,SAAW,WACzBH,EAAQE,MAAME,MAAQ,OACtB,MAAMC,EAASZ,SAASQ,cAAc,UACtCI,EAAOC,MAAQ,wBACfD,EAAOE,MAAQ,kBACfF,EAAOG,QAAU,OACjBH,EAAOH,MAAME,MAAQ,MACrBC,EAAOH,MAAMO,SAAW,OACxBJ,EAAOH,MAAMQ,OAAS,IACtBL,EAAOH,MAAMS,QAAU,QACvB,MAAMC,EAAM,IAAIC,IAAI,GAAGvB,EAAKX,WAAYmC,QAAQ,MAAM,oBACtDF,EAAIG,aAAaC,IAAI,IAAKC,OAAO3B,EAAKN,gBACtC4B,EAAIG,aAAaC,IAAI,QAASC,OAAO3B,EAAKP,QAC1CsB,EAAOO,IAAMA,EAAIM,WACjBlB,EAAQmB,YAAYd,GACpBd,EAAU4B,YAAYnB,GACtB,MAAMoB,EA/BR,SAAoBC,GAClB,MAAMC,EAAI7B,SAAS8B,OAAOC,MAAM,IAAIC,OAAO,WAAaJ,EAAKP,QAAQ,0BAA2B,QAAU,aAC1G,OAAOQ,EAAII,mBAAmBJ,EAAE,IAAM,IACxC,CA4BmBK,CAAWrC,EAAKL,gBAoBjCL,OAAOgD,iBAAiB,UAnBxB,SAAmBC,GACjB,MAAMC,EAAU,IAAIjB,IAAIvB,EAAKX,YAAaG,OAC1C,GAAI+C,EAAG/C,SAAWgD,IACgB,0BAA7BD,EAAGE,MAAQF,EAAGE,KAAKC,OACtB3B,EAAO4B,eAAeC,YAAY,CAChCF,KAAM,sBACNG,QAAS,CACPC,QAAS9C,EAAK8C,QACdpD,cAAeiC,OAAO3B,EAAKN,eAC3BD,MAAOO,EAAKP,MACZsD,cAAejB,GAAY,OAE5BU,GAE6B,2BAA7BD,EAAGE,MAAQF,EAAGE,KAAKC,OAAmC,CACzD,MAAMM,EAAIC,OAAOV,EAAGE,KAAKS,QAAU,GAC/BF,EAAI,IAAGjC,EAAOH,MAAMsC,OAAS,GAAGF,MACtC,CACF,EAEF,EAED,CArED"}
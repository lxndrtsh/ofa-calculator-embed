{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["type Options = {\n  apiBase: string;\n  configVersion?: string;\n  theme?: 'light'|'dark';\n  referralCookie?: string;\n  iframeBase?: string;\n};\ndeclare global {\n  interface Window { HPPEmbed: { init: (elOrId: HTMLElement|string, opts: Options) => void } }\n}\n(function () {\n  const DEFAULTS: Partial<Options> = {\n    iframeBase: (typeof window !== 'undefined' ? window.location.origin : '') + '',\n    theme: 'light',\n    configVersion: '1.0.0',\n    referralCookie: 'referral'\n  };\n  function getEl(elOrId: HTMLElement|string): HTMLElement {\n    if (typeof elOrId === 'string') {\n      const el = document.getElementById(elOrId);\n      if (!el) throw new Error(`HPPEmbed: container #${elOrId} not found`);\n      return el;\n    }\n    return elOrId;\n  }\n  function readCookie(name: string): string | null {\n    const m = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([$()*+./?[\\\\\\\\]^{|}])/g, '\\\\$1') + '=([^;]*)'));\n    return m ? decodeURIComponent(m[1]) : null;\n  }\n  function init(elOrId: HTMLElement|string, options: Options) {\n    const opts = { ...DEFAULTS, ...options };\n    const container = getEl(elOrId);\n    \n    // Prevent duplicate initialization\n    if (container.querySelector('iframe')) {\n      console.warn('HPPEmbed: container already initialized, skipping');\n      return;\n    }\n    \n    const wrapper = document.createElement('div');\n    wrapper.style.position = 'relative';\n    wrapper.style.width = '100%';\n    const iframe = document.createElement('iframe');\n    iframe.title = 'HPP Widget';\n    iframe.allow = 'clipboard-write';\n    iframe.loading = 'lazy';\n    iframe.style.width = '1px';\n    iframe.style.minWidth = '100%';\n    iframe.style.border = '0';\n    iframe.style.display = 'block';\n    const src = new URL(`${opts.iframeBase!.replace(/\\/$/,'')}/embed/impact`);\n    src.searchParams.set('v', String(opts.configVersion));\n    src.searchParams.set('theme', String(opts.theme));\n    iframe.src = src.toString();\n    wrapper.appendChild(iframe);\n    container.appendChild(wrapper);\n    const referral = readCookie(opts.referralCookie!);\n    function onMessage(ev: MessageEvent) {\n      const allowed = new URL(opts.iframeBase!).origin;\n      if (ev.origin !== allowed) return;\n      if ((ev.data && ev.data.type) === 'HPP_EMBED_READY') {\n        iframe.contentWindow?.postMessage({\n          type: 'HPP_EMBED_BOOT',\n          payload: {\n            apiBase: opts.apiBase,\n            configVersion: String(opts.configVersion),\n            theme: opts.theme,\n            referralToken: referral ?? null\n          }\n        }, allowed);\n      }\n      if ((ev.data && ev.data.type) === 'HPP_EMBED_RESIZE') {\n        const h = Number(ev.data.height || 0);\n        if (h > 0) iframe.style.height = `${h}px`;\n      }\n    }\n    window.addEventListener('message', onMessage);\n  }\n  window.HPPEmbed = { init };\n})();\n"]}